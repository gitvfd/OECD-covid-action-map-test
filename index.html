<doctype HTML>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<head>
	<link href="https://fonts.googleapis.com/css?family=Noto+Sans:400,400i,700,700i|Oswald:200,300,400,500,600,700&display=swap&subset=latin-ext" rel="stylesheet">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/site.css">


 <script src="libs/d3.v4.min.js"></script>
	<script src="libs/d3.v4.jetpack.min.js"></script>
	<script src="libs/d3-scale-chromatic.v1.min.js"></script>
	<script src="libs/topojson.v1.min.js"></script>
	<script src="libs/d3-queue.v3.min.js"></script>
	<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
	<script src="js/compChart.js"></script>

<script>

	dataLayer = [{

		"siteName": "oecd.github.io/OECD-covid-action-map",

		"siteEnvironment": "live",

		"pageLanguage": "en",         // or "en" or "es"

		"contentLanguage": "English",  // or "English" or "French"

		"pageTopic": "Coronavirus",

		"pageSubTopic": "",

		"pageCountry": "",

		"pageCategory": ""

	}];

</script>



<!-- Google Tag Manager -->

<script>(function (w, d, s, l, i) {
		w[l] = w[l] || []; w[l].push({
			'gtm.start':

				new Date().getTime(), event: 'gtm.js'
		}); var f = d.getElementsByTagName(s)[0],

			j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =

				'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);

	})(window, document, 'script', 'dataLayer', 'GTM-P5JSM4P');</script>

 <!--End Google Tag Manager -->

</head>

<body>

	<!-- Google Tag Manager (noscript) -->
	
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P5JSM4P" height="0" width="0"
			style="display:none;visibility:hidden"></iframe></noscript>
	
	<!--End Google Tag Manager (noscript) -->
	<Br />
	<!--<div id="warning">The country policy tracker will be available here <u>on March 30</u><Br/> <span id="warningtext">In the meantime, you can find OECD information on the impacts and consequences of the coronavirus pandemic on our lives and our societies at <a href="https://www.oecd.org/coronavirus">oecd.org/coronavirus</a></span></div>-->
	

	<div id="modedemploi">Click on the countries to access policy responses or look at the options to see the confinement levels and measures. 
				<div id="selCountry">
					<!--<div class="dropdown_text">Or select one directly: </div>-->
					<select id="country_dropdown"
						onchange="updateCard(value)">
						<option value="-" selected="selected"> - </option>
					</select>
				</div>
	</div>

	<div class="mySlides" id="aboutMap"></div>
	<div class="mySlides" id="jobMap"></div>
	<div class="mySlides" id="taxMap" >test1</div>
	<div class="mySlides" id="healthMap" >test2</div>

	<div id="CountryCard">
		<div id="shutterholder" >
			<img id="shutter" src="img/cross.svg">
			<div id="countrySel"></div>
			<div id="betaTag">&nbsp;Beta</div>
			<div id="flex-container_comp">
				<div id="updateTime"></div>
				
			</div>
		</div>
		<div id="navbar"></div>
		<Br />
		<div id="singleCountry"></div>
		<Br />
		<div id="noteCountry"></div>
	</div>
	<Br />
	</div>
	<div id="trackersLink">
		<div id="shutterholdertracker">
		<img id="shuttertracker" src="img/cross.svg">

		<div id="trackersText"><b>Find more country policy responses in these policy tracking initiatives:</b><Br />
			<ul>
				<li>
					<a href="http://www.oecd.org/tax/covid-19-tax-policy-and-other-measures.xlsm" target="_blank">Tax policy responses by country</a></li>
				<li><a href="http://www.oecd.org/social/Covid-19-Employment-and-Social-Policy-Responses-by-Country.xlsx"
				target="_blank">Employment and social policy responses by country</a></li>
				<li><a href="http://www.oecd.org/health/COVID19-OECD-Health-System-Response-Tracker.xlsx" target="_blank">Health policy responses by country</a></li>
			<li><a href="https://stip.oecd.org/Covid.html" target="_blank">Science and innovation policy responses by country</a></li>			
			</ul>
		</div>
		</div>
	</div>
	<div class="navigHeader">Confinement level:</div>
	<div class="flex-container">
			<button class="button grey" id="Dimension" type="submit"
				value="Containment-measures__Confinement-and-lock-downs__Level" title="Housing" onclick="updateMap(value)"><span
					class="textbtn">Confinement and lock downs</span></button>
			<button class="button grey" id="Dimension" type="submit"
				value="Containment-measures__Travel-bans-and-restrictions__Level" title="Housing"
				onclick="updateMap(value)"><span class="textbtn">Travel bans and restrictions</span></button>
			<button class="button grey" id="Dimension" type="submit" value="Containment-measures__Closure-of-schools__Level"
				title="Housing" onclick="updateMap(value)"><span class="textbtn">Closure of schools</span></button>
			<button class="button grey" id="Dimension" type="submit"
				value="Containment-measures__Cancellation-of-public-events-Closure-of-public-places__Level" title="Housing"
				onclick="updateMap(value)"><span class="textbtn">Cancellation of public events/Closure of public
					places</span></button>
			<button class="button grey" id="Dimension" type="submit"
				value="Containment-measures__Obligatory-shut-down-of-economic-activities__Level" title="Housing"
				onclick="updateMap(value)"><span class="textbtn">Obligatory shut down of economic activities</span></button>
	</div>
	<div class="navigHeader">Policy responses by subject:</div>
	<div class="flex-container">
			<button class="button green" id="allData" type="submit" value="allData" onclick="updateCircle(allData),updateSelector(value)"><span class="textbtn">Fiscal and monetary policy responses</span></button>
			<button class="button green" id="" type="submit" value="alljobs" onclick="updateCircle(alljobs),updateSelector(value)"><span class="textbtn">Employment and social policy responses</span></button>
			<!--<button class="button green" id="" type="submit" value="allhealth" onclick="updateCircle(allhealth),updateSelector(value)"><span class="textbtn">Health policy responses</span></button>
			<button class="button green" id="" type="submit" value="alltax" onclick="updateCircle(alltax),updateSelector(value)"><span class="textbtn">Tax policy responses</span></button>-->
	</div>
	<Br />
	<div class="flex-container">
		<div id="trackersNotes">
			<div id="updateTag">Beta version - Updated every day</div>
			<a id="source" href="https://oecd.github.io/OECD-covid-action-map/data/CoronavirusUpdate_AllCountries_Public.xlsx" target="_blank">Download the data</a>
			<div id="copyright">Â© 2020 Organisation for Economic Co-operation and Development</div>

		</div>

		<div id="morebtn">
			<!--More country policy responses: &nbsp;&nbsp;&nbsp;-->
		<div class="toTrackers" id="toTrackersBtn">More policy responses</div>
		</div>
	</div>
	<Br/>
	<div class="flex-container">
		<div id="disclaimer">This document, as well as any data and map included herein, are without prejudice to the status of
					or sovereignty over any territory, to the delimitation of international frontiers and boundaries and to the name of any territory, city
					or area.
		</div>
	</div>
</body>
<script type="text/javascript">


	var popupWidth;
	var heightChart ;
	var margin_chart
	var xScale;
	var yScale ;

	var worldData,allData,allVariables,alljobs,alljobsvariables;

	var selector="allData";

	var urls = {
	    world: "data/world.json",
	    country:"data/coord_country.tsv",
		actions:"data/actions.tsv",
		variables: "data/variables.tsv",
		jobs: "data/jobs.tsv",
		jobsvariables:"data/jobsvariables.tsv",
	};

	var divMap = d3.select("body").append("div") 
	    .attr("class", "tooltip")       
	    .style("opacity", 0);

    var format = d3.format(",.1f");
    var margin = 20,centered;

	var mapRatio=0.4;
    
    var width = document.getElementById("aboutMap").offsetWidth,
    	height= width*mapRatio;

	var quarantinecolor= d3.scaleOrdinal()
			.domain([0, 1, 2, 3, 4, 5])
			.range(['#d6e1e1', '#b0c4ca', '#8ba8b3', '#658c9c', '#3e7286', '#005870'])

  	var projection = d3.geoRobinson()
	    		.scale(width/7.5)
	    		.translate([width / 2, 6*height / 10])
  	        	.precision(.01);

  	var path = d3.geoPath()
                     .projection(projection);

  	var svg = d3.select("#aboutMap").append("svg")
  	    .attr("width", width)
  	    .attr("height", height)
 
    var worldMap=svg.append("g")

	var voronoiLayer = svg.append("g");

	var voronoi = d3.voronoi()
			.x(function (d) { return projection([d.lng, d.lat])[0]; })
			.y(function (d) { return projection([d.lng, d.lat])[1]; })
		.extent([[-1, -1], [width + 1, height + 1]]);
	
	var polygons;
	var polygonData;

	d3.queue()
	    .defer(d3.json, urls.world)
	    .defer(d3.tsv, urls.country)
		.defer(d3.tsv, urls.actions)
		.defer(d3.tsv, urls.variables)
		.defer(d3.tsv, urls.jobs)
		.defer(d3.tsv, urls.jobsvariables)
	    .await(render);

function setDropdown(data){
		document.getElementById("country_dropdown").innerHTML = "<option value=\"-\" selected=\"selected\"> - </option>";
	data.forEach(function(d){
		var x = document.getElementById("country_dropdown");
		
		var option = document.createElement("option");
		option.value = d.key;
		option.innerHTML = d.key;

		x.appendChild(option);



	
	})
}

	function render(err,world,country, actions,variables,jobs,jobsvariables){

		worldData=world;
		allData=actions;
		allVariables=variables;
		alljobs= jobs;
		alljobsvariables= jobsvariables;

		//compChart(actions)
		//Container for the gradients //https://www.visualcinnamon.com/2016/06/glow-filter-d3-visualization.html
		var defs = worldMap.append("defs");

		//Filter for the outside glow
		var filter = defs.append("filter")
		    .attr("id","glow");
		filter.append("feGaussianBlur")
		    .attr("stdDeviation","1.75")
		    .attr("result","coloredBlur");
		var feMerge = filter.append("feMerge");
		feMerge.append("feMergeNode")
		    .attr("in","coloredBlur");
		feMerge.append("feMergeNode")
		    .attr("in","SourceGraphic");

	    worldMap
	    	.attr("id","world")
	    	.selectAll("path")
	        .data(world.features)
	      	.enter().append("path")
	        .attr("class","world")
			.attr('fill', function(d){
				var value= "#c0c7c9";
				/*actions.forEach(function(k){
					if(k.ISO3== d.properties.ISO3_CODE){
						value = quarantinecolor(k['Containment-measures__Confinement-and-lock-downs__Level'])
					}
				})*/
				return value;
			})
			.attr('stroke', "#c0c7c9")
			.attr("d", path)
			
	  		updateCircle(allData);
	};	  

	function updateCircle(selData){

		if (selData===undefined){}else{
				var countryList = d3.nest()
					.key(function (d) { return d.Country; }).sortKeys(d3.ascending)
					.entries(selData);

				setDropdown(countryList);
		}

		worldMap.selectAll(".couCircle").remove();

		voronoiLayer.selectAll(".cell").remove();
		
		worldMap
			.selectAll(".couCircle")
			.data(selData)
			.enter().append("circle").attr("class", "couCircle")
			.attr("id", function (d) { return d.ISO3 + "circle"; })
			.attr("cx", function (d) {
				return projection([d.lng, d.lat])[0];
			})
			.attr("cy", function (d) {
				return projection([d.lng, d.lat])[1];
			})
			.attr("r", function (d) {
				if (d.ISO3 == "EU" || d.ISO3 == "SEA")
					return width / 250;
				else
					return width / 350;
			})
			.attr("fill", function (d) {
				if (d.ISO3 == "EU" || d.ISO3 == "SEA")
					return "#17a2b8";
				else
					return "#39617D";//"#04629a";
			})

		polygonData=selData;
		polygons = voronoi(polygonData).polygons();

		voronoiLayer.selectAll(".cell")
			.data(polygons)
			.enter()
			.append("path")
			.attr("class", "cell")
			.attr("fill", "none")
			.style("pointer-events", "all")
			.attr("stroke", "none")
			.attr("d", function (d) { return "M" + d.join("L") + "Z"; })
			.on('mouseover', function (d) {
				d3.select("#" + d.data.ISO3+"circle").attr("fill","#e73741")

				divMap.transition()
					.duration(250)
					.style("opacity", 1);
				
				var htmlText = "<b>" + d.data.Country + "</b>";
				divMap.html(htmlText)
					.style("left", event.pageX - document.body.scrollLeft + "px")
					.style("top", event.pageY - document.body.scrollTop + "px");

				})
			.on('mouseout', function (d) {
				
				if (d.data.ISO3 == "EU" || d.data.ISO3 == "SEA")
					d3.select("#" + d.data.ISO3 + "circle").attr("fill",  "#17a2b8");
				else
					d3.select("#" + d.data.ISO3 + "circle").attr("fill",  "#39617D");
			
				divMap.transition()
					.duration(250)
					.style("opacity", 0);
			})
			.on('click',function(d){
				updateCard(d.data.Country)
			});
			
	};
      


	d3.select(window).on('resize', resize);

	function resize() {
	    // adjust things when the window size changes
	    width = document.getElementById("aboutMap").offsetWidth,
	    height = width * mapRatio;

	    // update projection
	    projection
	        .translate([width / 2, 6 * height / 10])
	        .scale(width/7.5);

	    // resize the map container
	    svg.attr('width', width + 'px')
	        .attr('height', height + 'px');

	    // resize the map
	    worldMap.selectAll('.world').attr('d', path);
	    //world.selectAll('.state').attr('d', path);
	    

	    worldMap.selectAll('circle')
			.attr("cx", function (d) {
				return projection([d.lng, d.lat])[0];
			})
			.attr("cy", function (d) {
				return projection([d.lng, d.lat])[1];
			})
	      	.attr("r",width/300);

		voronoi
			.extent([[-1, -1], [width + 1, height + 1]]);
		
		polygons = voronoi(polygonData.filter(function (d) { return d.isOnMap != ""; })).polygons();

		voronoiLayer.selectAll(".cell")
			.data(polygons)
			.attr("fill", "none")
			.style("pointer-events", "all")
			.attr("stroke", "none")
			.attr("d", function (d) { return "M" + d.join("L") + "Z"; })
	}
	

	function updateCard(couName){
console.log(selector)
		var selData,selVariables;
		if(selector=="allData"){
			selData=allData;
			selVariables=allVariables;
		}
		else if (selector == "alljobs") {
			selData =alljobs;
			selVariables =alljobsvariables;
		}
		else if (selector == "allhealth"){
			selData = allhealth;
			selVariables = allhealthvariables;
		}
		else if (selector == "alltax"){
			selData = alltax;
			selVariables = alltaxvariables;
		}

		var temp= selData.filter(function (d) { return d.Country == couName })

		document.getElementById("CountryCard").style.display = 'block';
			//document.getElementById("modedemploi").style.display = 'none';

		document.getElementById("countrySel").innerHTML = temp[0].Country;

		document.getElementById("updateTime").innerHTML = "Updated on " + temp[0].update;
		var navText="Table of content <Br/>";
		var countryText="";
		selVariables.forEach(function(d){
				if (d.level== "SectionTitle"){
					countryText= countryText+ "<div class=\"border\" id=\"" + d.title.replace(/ /g, "") +"\" ><span class=\"SectionTitle\">"+d.title+"</span></div><Br/>"
					navText= navText + "<a class=\"couNav\" href=\"#" + d.title.replace(/ /g,"") + "\">" + d.title + "</a><Br/>"
				}else if(d.level=="SectionText"){
					countryText = countryText + "<div  class=\"SectionText\"><b>"+d.title+"</b><br/>"+ temp[0][d.code]+"</div><Br/>";
				} else if (d.level == "SectionChart") {
					countryText = countryText + "<div class=\"SectionChart\"><b>"+ d.title+"</b> - <i>" + d.unit +"</i></div><br/><div class=\"SectionChart\" id=\""+ d.code+"\"></div><Br/>" ;
				}
		})

		document.getElementById("navbar").innerHTML = navText;
		document.getElementById("singleCountry").innerHTML= countryText

		if (couName == "Kosovo**")
				document.getElementById("noteCountry").innerHTML = "<b>Note on Kosovo</b>: This designation is without prejudice to positions on status, and is in line with United Nations Security Council Resolution 1244/99 and the Advisory Opinion of the International Court of Justice on Kosovo's declaration of independence."
		else if (couName == "Israel*")
				document.getElementById("noteCountry").innerHTML = "<b>Note on Israel</b>: The statistical data for Israel are supplied by and under the responsibility of the relevant Israeli authorities. The use of such data by the OECD is without prejudice to the status of the Golan Heights, East Jerusalem and Israeli settlements in the West Bank under the terms of international law."
		else
				document.getElementById("noteCountry").innerHTML = ""

		allVariables.forEach(function (d) {
			if (d.level == "SectionChart") {
				compChart(selData,d.code)	
				highlight(couName, selData.filter(function (k) { return k[d.code] != "--" && k[d.code] != "Information not available" && k[d.code] != "null" && k[d.code] != "" && !(isNaN(k[d.code]) )}).length,d.code)				
			} 
		})
	}


function 	updateSelector(string){
	selector=string;
}

/*function updateTracker(value){
	d3. selectAll(".mySlides").style("display","none")

	document.getElementById(value).style.display = 'block';
			//document.getElementById("modedemploi").style.display = 'none';
}*/
		
function updateMap(value){
	worldMap
		.selectAll("path")
		.data(worldData.features)

		.transition().duration(500)
		
		.attr('fill', function (d) {
			
			var basecolor = "#c0c7c9";
			allData.forEach(function (k) {
				if (k.ISO3 == d.properties.ISO3_CODE) {
					if (k[value]!='Information not available' && k[value]!= '')
						basecolor = quarantinecolor(k[value])
				}
			})
			return basecolor;
		})
		.style("opacity",0.75)

	voronoiLayer.selectAll(".cell")
	
		.on('mouseover', function (d) {

			var variable= value.replace(/__Level/g,"")+"__Description";
			//var element = d3.select("#" + d.data.ISO3 + "circle")

			d3.select("#" + d.data.ISO3 + "circle").attr("fill", "#e73741")

			divMap.transition()
				.duration(250)
				.style("opacity", 1);

			var icuText;
			if (d.data[value] == 'Information not available' || d.data[value] == '')
				icuText = ""
			else
				icuText = "<br/><b>confinement Level: " + d.data[value] + "</b><Br/>"+ d.data[variable];

			var htmlText = "<b>" + d.data.Country + "</b>"+   icuText;

			divMap.html(htmlText)
			//	.style("left", parseFloat(document.getElementById("aboutMap").getBoundingClientRect().left) + parseFloat(element.attr('cx')) + "px")
			//	.style("top", parseFloat(document.getElementById("aboutMap").getBoundingClientRect().top) + parseFloat(element.attr('cy')) + "px");
				.style("left", event.pageX - document.body.scrollLeft + "px")
				.style("top", event.pageY - document.body.scrollTop + "px");

		})
		.on('mouseout', function (d) {

			if (d.data.ISO3 == "EU" || d.data.ISO3 == "SEA")
				d3.select("#" + d.data.ISO3 + "circle").attr("fill", "#17a2b8");
			else
				d3.select("#" + d.data.ISO3 + "circle").attr("fill", "#39617D");

			divMap.transition()
				.duration(250)
				.style("opacity", 0);
		})
		.on('click', function (d) {
			updateCard(d.data.Country)
		});
		
}


	d3.select("#shutter")
	.on("mouseover",function(){
		d3.select(this).style("opacity",0.5);
	})
	.on("mouseout", function () {
			d3.select(this).style("opacity", 1);
	})
	.on("click",function(){
		document.getElementById("CountryCard").style.display = 'none';

		document.getElementById("country_dropdown").value = '-';
		//document.getElementById("modedemploi").style.display = 'block';
	})


	d3.select("#shuttertracker")
		.on("mouseover", function () {
			d3.select(this).style("opacity", 0.5);
		})
		.on("mouseout", function () {
			d3.select(this).style("opacity", 1);
		})
		.on("click", function () {

			document.getElementById("trackersLink").style.display = 'none';
		})
    
		d3.select("#toTrackersBtn")
				.on("click", function () {
					document.getElementById("trackersLink").style.display = 'block';
				})

	d3.selectAll(".button.grey")
		.on("click", function () {
			d3.selectAll(".button.grey")
				.style("background-color", "#ffffff").style("color","#0b1e2d")
			d3.select(this)
				.style("background-color", "#04629a").style("color", "#ffffff")
		})

	d3.selectAll(".button.green")
		.on("click", function () {
			d3.selectAll(".button.green")
				.style("background-color", "#548235")
			d3.select(this)
				.style("background-color", "#0b1e2d")
		})
</script>
<!--<script src="js/jobsindex.js"></script>-->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51983915-1', 'auto');
  ga('send', 'pageview');

</script>
